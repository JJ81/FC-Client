"use strict";window.requirejs(["common","aquaPlayerService","easyTimer","text!/win_aquaplayer_html5.html","text!/win_aquaplayer_window.html","jqueryTimer"],function(e,t,n,a,o){function i(e){}function r(){console.log("initPlayer"),h.setVolume(.5),h.bindEvent("Error",function(e,t){i("player:Error "+t),console.error(t)}),h.bindEvent("OpenStateChanged",function(e){switch(i("player:OpenStateChanged"),e){case window.NPlayer.OpenState.Opened:i("player:OpenStateChanged:Opened"),j=h.getDuration(),d();break;case window.NPlayer.OpenState.Closed:i("player:OpenStateChanged:Closed")}}),h.bindEvent("PlayStateChanged",function(e){switch(i("player:PlayStateChanged"),e){case window.NPlayer.PlayState.Playing:i("player:PlayStateChanged:Playing"),u(),k&&k.reset(1e3*C);break;case window.NPlayer.PlayState.Stopped:case window.NPlayer.PlayState.Paused:i("player:PlayStateChanged:Stopped/Paused"),k.pause(),c()}}),h.bindEvent("PlaybackCompleted",function(){i("player:PlaybackCompleted"),k.pause(),g(),c(),L||setTimeout(function(){f(".timer").removeClass("blind"),console.log("second timer started"),T.start({countdown:!0,startValues:{seconds:30}}),E.html(T.getTimeValues().toString()+" 초 이내 <b>다음</b> 버튼을 클릭해주세요."),T.addEventListener("secondsUpdated",function(e){E.html(T.getTimeValues().toString()+" 초 이내 <b>다음</b> 버튼을 클릭해주세요.")}),T.addEventListener("targetAchieved",function(e){E.html("학습 초기화 중입니다.."),setTimeout(function(){window.alert("30초 동안 다음 버튼을 누르지 않아 학습을 초기화 하였습니다.\n\n재시청 해주시기 바랍니다."),v.all([y(),m()]).then(v.spread(function(e,t){window.location.reload()}))},3e3)})},1e3)})}function d(){j?(k=f.timer(1e3*C,l,!0),k.stop(),s()):console.error("을 확인할 수 없습니다.")}function s(){g()}function l(){O+=C;var e=h.getCurrentPlaybackTime();if(w>0&&w===e)return h.pause(),void b.removeClass("blind");w=e,f.ajax({type:"POST",url:"/video/log/playtime",data:{training_user_id:D,video_id:q,played_seconds:O,video_duration:j,currenttime:e}}).done(function(e){e.success?(O=0,V=e.total_played_seconds,g()):(console.error(e.msg),h.pause().then(function(){}).catch(function(e){console.error(e)}))})}function c(){i("videoEndTimeLogger"),f.ajax({type:"POST",url:"/video/log/endtime",data:{video_id:q}}).done(function(e){e.success||console.error(e.msg)})}function u(){i("sessionProgressStartLogger"),f.ajax({type:"POST",url:"/session/log/starttime",data:{training_user_id:P.data("training-user-id"),course_id:P.data("course-id"),course_list_id:P.data("course-list-id")}}).done(function(e){e.success?L=e.hasEnded:(console.error(e.msg),k.stop(),h.stop())})}function p(){i("sessionProgressEndLogger"),f.ajax({type:"POST",url:"/session/log/endtime",data:{training_user_id:P.data("training-user-id"),course_id:P.data("course-id"),course_list_id:P.data("course-list-id")}}).done(function(e){e.success?window.location.href=N:console.error(e.msg)})}function g(){i("showPlayBtn"),i("videoDuration:"+j),i("passiveRate:"+x),i("videoTotalPlayedSeconds:"+V),Math.floor(j*(x/100))<=V&&(S.removeClass("blind"),b.addClass("blind"))}function y(){return i("deleteVideoLog"),v.delete("/video/log",{params:{video_id:P.data("id")}}).then(function(e){}).catch(function(e){console.error(e)})}function m(){return i("deleteSessionLog"),v.delete("/session/log",{params:{training_user_id:P.data("training-user-id"),course_list_id:P.data("course-list-id")}}).then(function(e){}).catch(function(e){console.error(e)})}var w,f=f||window.$,v=v||window.axios,_=e.getOSName(),h=null,P=f(".videoplayer"),S=f("#btn_play_next"),b=f("#btn_replay_video"),C=P.data("interval"),k=null,O=0,T=new n,E=f("#countdown .values"),x=P.data("passive-rate"),L=!1,N=S.parent().attr("href"),j=null,q=P.data("id"),V=P.data("total-play"),D=S.data("training-user-id");f(function(){var e,n={video_url:P.data("video-url"),watermark:P.data("watermark")};"Windows"===_?(i("window"),e=window.Handlebars.compile(a)):(i("html5"),e=window.Handlebars.compile(a)),f("#aqua-player").append(e(n)),t=new t({fileUrl:n.video_url,watermark:n.watermark,callback:function(e){e&&(h=e,r())}})}),S.on("click",function(e){i("btnPlayNext:click"),e.preventDefault(),T.stop(),p()}),b.on("click",function(e){e.preventDefault(),h.play(),b.addClass("blind")})});
//# sourceMappingURL=../maps/video_aqua_pc.js.map
